<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>FsStorm
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content="F# DSL and runtime for Storm topologies"/>
    <meta name="author" content="Faisal Waris, Eugene Tolmachev"/>

    <script src="https://code.jquery.com/jquery-1.8.0.js"></script>
    <script src="https://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet"/>

    <link type="text/css" rel="stylesheet" href="/FsStorm/content/style.css" />
    <script type="text/javascript" src="/FsStorm/content/tips.js"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="https://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <div class="masthead">
        <ul class="nav nav-pills pull-right">
          <li><a href="http://fsharp.org">fsharp.org</a></li>
          <li><a href="http://github.com/FsStorm/FsStorm">github page</a></li>
        </ul>
        <h3 class="muted"><a href="/FsStorm/index.html">FsStorm</a></h3>
      </div>
      <hr />
      <div class="row">
        <div class="span9" id="main">
          
<h1><a name="FsStorm" class="anchor" href="#FsStorm">FsStorm</a></h1>

<h2><a name="Overview" class="anchor" href="#Overview">Overview</a></h2>

<p>FsStorm is a library for implementation of <a href="https://storm.apache.org/">Apache Storm</a> components, definition of topologies in F# DSL and submission via F# scripts for execution.
The topology and the components could be implemented in a single EXE project and are executed by Storm via its <a href="https://storm.apache.org/documentation/Multilang-protocol.html">multilang</a> protocol as separate processes - one for each task/instance.
Accompanying FsJson library is used for dealing with Json structures passed in and out of Storm.</p>

<h2><a name="FsStorm-components" class="anchor" href="#FsStorm-components">FsStorm components</a></h2>

<p>FsStorm components are defined as functions that take at least one (last) argument: configuration passed in from Storm. In practice, you'll want to pass all your dependencies in, and that means at least one other: a runner, passed in from your topology. 
Additionally you can pass as many arguments from the topology as needed.
Think of the component function as "main" for your program. Storm will start (a copy of) the same EXE for all components in the topology, and will instruct each instance with the task it supposed to execute.
The "main" function will be called by FsStorm once per instance of every component and its purpose is to construct either "next" function for spouts or "consume" function for bolts and pass it to a runner.
FsStorm implements several runners that either talk to Storm or allow you to unit-test your components by recording outputs or playing back the inputs.</p>

<h2><a name="FsStorm-tuples" class="anchor" href="#FsStorm-tuples">FsStorm tuples</a></h2>

<p>Storm components communicate by passing tuples to each other over streams. The tuples are emmited into streams and have schema defined by the spout topology Output element.
Storm multilang is wrapped and accessible via included FsJson.
In addition to raw json access, FsStorm defines several helpers: tuple, namedStream, anchor, etc. that help to abstract the specifics of underlying multilang.</p>

<h2><a name="Example-of-a-spout" class="anchor" href="#Example-of-a-spout">Example of a spout</a></h2>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">open</span> <span class="i">FsJson</span>
<span class="k">open</span> <span class="i">Storm</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs1', 1)" onmouseover="showTip(event, 'fs1', 1)" class="i">rnd</span> <span class="o">=</span> <span class="k">new</span> <span onmouseout="hideTip(event, 'fs2', 2)" onmouseover="showTip(event, 'fs2', 2)" class="i">System</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs3', 3)" onmouseover="showTip(event, 'fs3', 3)" class="t">Random</span>() <span class="c">// used for generating random messages</span>

<span class="c">///spout - produces messages</span>
<span class="c">///cfg: the configuration passed in by Storm</span>
<span class="c">///runner: a spout runner function (passed in from topology)</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs4', 4)" onmouseover="showTip(event, 'fs4', 4)" class="f">spout</span> <span onmouseout="hideTip(event, 'fs5', 5)" onmouseover="showTip(event, 'fs5', 5)" class="f">runner</span> <span onmouseout="hideTip(event, 'fs6', 6)" onmouseover="showTip(event, 'fs6', 6)" class="i">cfg</span> <span class="o">=</span> 
    <span class="c">//define the function that will produce the tuples</span>
    <span class="c">//emit: a function that emits message to storm (passed in by the runner)</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs7', 7)" onmouseover="showTip(event, 'fs7', 7)" class="f">next</span> <span onmouseout="hideTip(event, 'fs8', 8)" onmouseover="showTip(event, 'fs8', 8)" class="f">emit</span> <span class="o">=</span> <span class="k">fun</span> () <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs9', 9)" onmouseover="showTip(event, 'fs9', 9)" class="i">async</span> { <span class="i">tuple</span> [ <span onmouseout="hideTip(event, 'fs1', 10)" onmouseover="showTip(event, 'fs1', 10)" class="i">rnd</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs10', 11)" onmouseover="showTip(event, 'fs10', 11)" class="i">Next</span>(<span class="n">0</span>, <span class="n">100</span>) ] <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs8', 12)" onmouseover="showTip(event, 'fs8', 12)" class="f">emit</span> } <span class="c">//the &quot;next&quot; function</span>
    <span class="c">//run the spout</span>
    <span onmouseout="hideTip(event, 'fs7', 13)" onmouseover="showTip(event, 'fs7', 13)" class="f">next</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs5', 14)" onmouseover="showTip(event, 'fs5', 14)" class="f">runner</span>
</pre>
</td>
</tr>
</table>

<h2><a name="Topology-DSL-in-F" class="anchor" href="#Topology-DSL-in-F">Topology DSL in F#</a></h2>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="c">//define the storm topology</span>
<span class="k">open</span> <span class="i">StormDSL</span>
<span class="k">open</span> <span class="i">FsJson</span>

<span class="c">//example of using FsStorm DSL for defining topologies</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs11', 15)" onmouseover="showTip(event, 'fs11', 15)" class="i">topology</span> <span class="o">=</span> 
    { <span class="i">TopologyName</span> <span class="o">=</span> <span class="s">&quot;FstSample&quot;</span>
      <span class="i">Spouts</span> <span class="o">=</span> 
          [ { <span class="i">Id</span> <span class="o">=</span> <span class="s">&quot;SimpleSpout&quot;</span> <span class="c">// unique Id</span>
              <span class="i">Outputs</span> <span class="o">=</span> [ <span class="i">Default</span> [ <span class="s">&quot;number&quot;</span> ] ] <span class="c">// default stream schema</span>
              <span class="i">Spout</span> <span class="o">=</span> <span class="i">Local</span> { <span class="i">Func</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs4', 16)" onmouseover="showTip(event, 'fs4', 16)" class="i">spout</span> <span class="i">Storm</span><span class="o">.</span><span class="i">simpleSpoutRunner</span> }
              <span class="c">// configuration Storm will use with each instance of the component </span>
              <span class="i">Config</span> <span class="o">=</span> <span class="i">JsonNull</span> 
              <span class="i">Parallelism</span> <span class="o">=</span> <span class="n">1</span> } ] <span class="c">// one instance</span>
      <span class="i">Bolts</span> <span class="o">=</span> 
          [ { <span class="i">Id</span> <span class="o">=</span> <span class="s">&quot;AddOneBolt&quot;</span>
              <span class="i">Outputs</span> <span class="o">=</span> [ <span class="i">Default</span> [ <span class="s">&quot;number&quot;</span> ] ]
              <span class="c">// default stream of SimpleSpout, no grouping/affinity </span>
              <span class="i">Inputs</span> <span class="o">=</span> [ <span class="i">DefaultStream</span> <span class="s">&quot;SimpleSpout&quot;</span>, <span class="i">Shuffle</span> ]
              <span class="i">Bolt</span> <span class="o">=</span> <span class="i">Local</span> { <span class="i">Func</span> <span class="o">=</span> <span class="i">addOneBolt</span> <span class="i">Storm</span><span class="o">.</span><span class="i">autoAckBoltRunner</span> <span class="i">Logging</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs12', 17)" onmouseover="showTip(event, 'fs12', 17)" class="i">log</span> <span class="i">Storm</span><span class="o">.</span><span class="i">emit</span>}
              <span class="i">Config</span> <span class="o">=</span> <span class="i">JsonNull</span>
              <span class="i">Parallelism</span> <span class="o">=</span> <span class="n">2</span> } <span class="c">// two instances of the process/component</span>
            { <span class="i">Id</span> <span class="o">=</span> <span class="s">&quot;ResultBolt&quot;</span>
              <span class="i">Outputs</span> <span class="o">=</span> [] <span class="c">// no output</span>
              <span class="i">Inputs</span> <span class="o">=</span> [ <span class="i">DefaultStream</span> <span class="s">&quot;AddOneBolt&quot;</span>, <span class="i">Shuffle</span> ]
              <span class="i">Bolt</span> <span class="o">=</span> <span class="i">Local</span> { <span class="i">Func</span> <span class="o">=</span> <span class="i">resultBolt</span> <span class="i">Storm</span><span class="o">.</span><span class="i">autoAckBoltRunner</span> <span class="i">Logging</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs12', 18)" onmouseover="showTip(event, 'fs12', 18)" class="i">log</span> }
              <span class="i">Config</span> <span class="o">=</span> <span class="i">JsonNull</span>
              <span class="i">Parallelism</span> <span class="o">=</span> <span class="n">2</span> } ] }
</pre>
</td>
</tr>
</table>

<h2><a name="Submitting-the-topology-using-F-scripts" class="anchor" href="#Submitting-the-topology-using-F-scripts">Submitting the topology using F# scripts</a></h2>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="prep">#I</span> <span class="s">&quot;../../Refs&quot;</span>
<span class="prep">#I</span> <span class="s">&quot;../../packages/Thrift/lib/net35&quot;</span>
<span class="prep">#load</span> <span class="s">&quot;StormSubmit.fsx&quot;</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs13', 19)" onmouseover="showTip(event, 'fs13', 19)" class="i">binDir</span> <span class="o">=</span> <span class="s">&quot;build&quot;</span>

<span onmouseout="hideTip(event, 'fs14', 20)" onmouseover="showTip(event, 'fs14', 20)" class="t">StormSubmit</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs15', 21)" onmouseover="showTip(event, 'fs15', 21)" class="f">runTopology</span> <span onmouseout="hideTip(event, 'fs13', 22)" onmouseover="showTip(event, 'fs13', 22)" class="i">binDir</span> <span class="s">&quot;localhost&quot;</span> <span onmouseout="hideTip(event, 'fs14', 23)" onmouseover="showTip(event, 'fs14', 23)" class="t">StormSubmit</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs16', 24)" onmouseover="showTip(event, 'fs16', 24)" class="i">default_nimbus_port</span>
</pre>
</td>
</tr>
</table>

<h2><a name="Samples-amp-documentation" class="anchor" href="#Samples-amp-documentation">Samples &amp; documentation</a></h2>

<ul>
<li><p><a href="sample.html">FstSample</a> contains a "unreliable" spout example - emitted tuples do not require ack, could be lost in case of failure.</p></li>
<li><p><a href="guaranteed.html">FstGuaranteedSample</a> contains a "reliable" spout example - emitted tuples have unique ID and require ack.</p></li>
<li><p><a href="reference/index.html">API Reference</a> contains automatically generated documentation for public types, modules
and functions in the library.</p></li>
</ul>

<h2><a name="Getting-FsStorm" class="anchor" href="#Getting-FsStorm">Getting FsStorm</a></h2>

<div class="row">
  <div class="span1"></div>
  <div class="span6">
    <div class="well well-small" id="nuget">
      The FsStorm library can be <a href="https://nuget.org/packages/FsStorm">installed from NuGet</a>:
      <pre>PM> Install-Package FsStorm</pre>
    </div>
  </div>
  <div class="span1"></div>
</div>

<h2><a name="Contributing-and-copyright" class="anchor" href="#Contributing-and-copyright">Contributing and copyright</a></h2>

<p>The project is hosted on <a href="https://github.com/FsStorm/FsStorm">GitHub</a> where you can <a href="https://github.com/FsStorm/FsStorm/issues">report issues</a>, fork 
the project and submit pull requests. If you're adding a new public API, please also 
consider adding <a href="https://github.com/FsStorm/FsStorm/tree/master/docs/content">samples</a> that can be turned into a documentation. You might
also want to read the <a href="https://github.com/FsStorm/FsStorm/blob/master/README.md">library design notes</a> to understand how it works.</p>

<p>The library is available under MIT license, which allows modification and 
redistribution for both commercial and non-commercial purposes. For more information see the 
<a href="https://github.com/FsStorm/FsStorm/blob/master/LICENSE.md">License file</a> in the GitHub repository.</p>

<div class="tip" id="fs1">val rnd : System.Random<br /><br />Full name: Index.rnd</div>
<div class="tip" id="fs2">namespace System</div>
<div class="tip" id="fs3">Multiple items<br />type Random =<br />&#160;&#160;new : unit -&gt; Random + 1 overload<br />&#160;&#160;member Next : unit -&gt; int + 2 overloads<br />&#160;&#160;member NextBytes : buffer:byte[] -&gt; unit<br />&#160;&#160;member NextDouble : unit -&gt; float<br /><br />Full name: System.Random<br /><br />--------------------<br />System.Random() : unit<br />System.Random(Seed: int) : unit</div>
<div class="tip" id="fs4">val spout : runner:(((&#39;a -&gt; unit) -&gt; unit -&gt; Async&lt;unit&gt;) -&gt; &#39;b) -&gt; cfg:&#39;c -&gt; &#39;b<br /><br />Full name: Index.spout<br /><em><br /><br />spout - produces messages<br />cfg: the configuration passed in by Storm<br />runner: a spout runner function (passed in from topology)</em></div>
<div class="tip" id="fs5">val runner : (((&#39;a -&gt; unit) -&gt; unit -&gt; Async&lt;unit&gt;) -&gt; &#39;b)</div>
<div class="tip" id="fs6">val cfg : &#39;c</div>
<div class="tip" id="fs7">val next : ((&#39;d -&gt; unit) -&gt; unit -&gt; Async&lt;unit&gt;)</div>
<div class="tip" id="fs8">val emit : (&#39;d -&gt; unit)</div>
<div class="tip" id="fs9">val async : AsyncBuilder<br /><br />Full name: Microsoft.FSharp.Core.ExtraTopLevelOperators.async</div>
<div class="tip" id="fs10">System.Random.Next() : int<br />System.Random.Next(maxValue: int) : int<br />System.Random.Next(minValue: int, maxValue: int) : int</div>
<div class="tip" id="fs11">val topology : obj<br /><br />Full name: Index.topology</div>
<div class="tip" id="fs12">val log : value:&#39;T -&gt; &#39;T (requires member Log)<br /><br />Full name: Microsoft.FSharp.Core.Operators.log</div>
<div class="tip" id="fs13">val binDir : string<br /><br />Full name: Index.binDir</div>
<div class="tip" id="fs14">module StormSubmit</div>
<div class="tip" id="fs15">val runTopology : binDir:string -&gt; nimbus_host:string -&gt; nimbus_port:int -&gt; unit<br /><br />Full name: StormSubmit.runTopology</div>
<div class="tip" id="fs16">val default_nimbus_port : int<br /><br />Full name: StormSubmit.default_nimbus_port</div>

        </div>
        <div class="span3">
          <img src="/FsStorm/img/logo.png" alt="F# Project" style="width:150px;margin:10px" />  
          <ul class="nav nav-list" id="menu" style="margin-top: 20px;">
            <li class="nav-header">FsStorm</li>
            <li><a href="/FsStorm/index.html">Home page</a></li>
            <li class="divider"></li>
            <li><a href="http://nuget.org/packages/FsStorm">Get Library via NuGet</a></li>
            <li><a href="http://github.com/FsStorm/FsStorm">Source Code on GitHub</a></li>
            <li><a href="/FsStorm/LICENSE.html">License</a></li>
            <li><a href="/FsStorm/RELEASE_NOTES.html">Release Notes</a></li>
            
            <li class="nav-header">Getting started
            <li><a href="/FsStorm/sample.html">Basics</a>
			<ul>
			<li><a href="/FsStorm/sample.html#Defining-unreliable-spouts">Spout</a></li>
			<li><a href="/FsStorm/sample.html#Defining-bolts">Bolt</a></li>
			<li><a href="/FsStorm/sample.html#Using-F-DSL-to-define-the-topology">Topology</a></li>
			<li><a href="/FsStorm/sample.html#Unit-testing-the-components">Unit-testing</a></li>
			</ul>
			</li>
            <li><a href="/FsStorm/guaranteed.html">Guaranteed processing</a>
			<ul>
			<li><a href="/FsStorm/guaranteed.html#Defining-reliable-spouts">Reliable Spout</a></li>
			<li><a href="/FsStorm/guaranteed.html#Anchoring-and-named-streams">Anchoring and named streams</a></li>
			<li><a href="/FsStorm/guaranteed.html#Topology-with-named-streams-and-config-overrides">Parametrization</a></li>
			</ul>
			</li>

            <li class="nav-header">Documentation</li>
            <li><a href="/FsStorm/reference/index.html">API Reference</a></li>
          </ul>
        </div>
      </div>
    </div>
    <a href="http://github.com/FsStorm/FsStorm"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"/></a>
  </body>
  </html>
